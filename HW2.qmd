---
title: "EDS223 Homework 2"
author: "Sofia Sarak"
format: pdf
editor: visual
---

* include unit tests and warnings/error messages!

gt package: install and load

```{r}
# basic syntax
# Use the gt function
data %>%
  gt() %>% 
  tab_header(title = md("What a **nice title**"),
               subtitle = md("Pretty *cool subtitle* too, `isn't it?`"))
```


## Initial Setup

```{r}
# Loading in necessary libraries
library(here)
library(tidyverse)
library(sf)
library(stars)
library(tmap)
```

```{r}
# Loading in data
ineq <- st_read(here('data/mapping-inequality/mapping-inequality-los-angeles.json'))
birds <- st_read(here('data/gbif-birds-LA/gbif-birds-LA.shp'))
```
Exploring and Trasnforming CRS'
```{r}
# Checking to see if CRS' of each dataset are the same
if (st_crs(ineq) == st_crs(birds)){
  print("Same CRS")
} else {
    print("Different CRS")
}

# the two data sets have the same CRS, yay!
```


# Part 1: Legacy of redlining in current environmental (in)justice

1. **Create a map of historical redlining neighborhoods**, including:
- neighborhoods colored by HOLC grade
- an appropriate base map
- a clear title and legend

```{r}
# sourcing base map
ejscreen <- st_read(here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))

la <- ejscreen %>%
  filter(ST_ABBREV == "CA") %>% 
  filter(CNTY_NAME %in% c("Los Angeles County"))
```


```{r}
tm_shape(la, bbox = ineq) + 
  tm_borders() +
tm_shape(ineq) +
  tm_fill("grade") 
```

2. **Create a table** summarizing:
- the percentage of census block groups that fall within each HOLC grade
- Also include the percent of census black groups that don’t fall within a HOLC grade
- Hint: The HOLC data contains the grades and the EJScreen data contains the census blocks, so you will need to combine the data spatially before doing summary statistics. Once you combine and no longer need the geometries, you can use `st_drop_geometry()`.

```{r}

```

3. **Create at least two visualizations summarizing current conditions** (from the EJScreen data) within HOLC grades using the mean of the following variables (you may combine variables or create separate plots):
- % low income
- percentile for Particulate Matter 2.5
- percentile for low life expectancy
- Use `ggplot` for your visualizations! You will first need to calculate mean of each variable grouped by HOLC grade.

Visualization 1
```{r}

```

Visualization 2
```{r}

```

4. **Write a brief paragraph reflecting on these results**
- Interpret the patterns you observe in your results
- Discuss potential relationships between historical redlining grades and current environmental/socioeconomic conditions

# Part 2: Legacy of redlining in biodiversity observations

**You must produce the following based on observations from 2021-2023:**

1. **A figure summarizing the percent of observations within redlined neighborhoods within each HOLC grade**

Create a visualizations that shows:

- The percentage of bird observations within each HOLC grade
- Include an appropiate title, axis labels, and legend
- Hints: Ensure the bird observations and HOLC dataset have matching CRS’, then perform a spatial join to assign each bird observations to a corresponding HOLC grade.

2. Spoiler alert!! Our results don’t match the findings from Ellis-Soto et al. 2023! Read the abstract of the study. Why might we have obtained different results in our analysis? What did the paper consider that we did not?

